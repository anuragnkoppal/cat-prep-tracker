<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAT VARC AEON ESSAY Prep Tracker</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TG8RLMFDMG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TG8RLMFDMG');
    </script>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const { useState, useEffect } = React;
        const e = React.createElement;

        function CATTracker() {
            const [essays, setEssays] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [search, setSearch] = useState('');
            const [filter, setFilter] = useState('all');
            const [expanded, setExpanded] = useState({});
            const [step, setStep] = useState('title');
            const [form, setForm] = useState({ title: '', link: '', words: [''] });
            const [meanings, setMeanings] = useState({});
            const [revealed, setRevealed] = useState({});
            const [editing, setEditing] = useState(null);
            const [editText, setEditText] = useState('');
            const [darkMode, setDarkMode] = useState(false);

            useEffect(() => {
                const stored = localStorage.getItem('cat-essays');
                if (stored) setEssays(JSON.parse(stored));
                
                const darkStored = localStorage.getItem('darkMode');
                if (darkStored) setDarkMode(darkStored === 'true');
            }, []);

            useEffect(() => {
                localStorage.setItem('darkMode', darkMode);
            }, [darkMode]);

            const save = (data) => localStorage.setItem('cat-essays', JSON.stringify(data));

            const next = () => {
                if (step === 'title' && (!form.title.trim() || !form.link.trim())) {
                    return alert('Please fill title and link');
                }
                if (step === 'words' && !form.words.filter(w => w.trim()).length) {
                    return alert('Add at least one word');
                }
                setStep(step === 'title' ? 'words' : 'meanings');
            };

            const submit = () => {
                const words = form.words.filter(w => w.trim()).map(w => ({
                    word: w.trim(),
                    meaning: meanings[w.trim()] || ''
                }));
                const essay = {
                    id: Date.now(),
                    title: form.title,
                    link: form.link,
                    words,
                    date: new Date().toLocaleDateString(),
                    timestamp: Date.now()
                };
                const updated = [essay, ...essays];
                setEssays(updated);
                save(updated);
                setForm({ title: '', link: '', words: [''] });
                setMeanings({});
                setStep('title');
                setShowForm(false);
            };

            const del = (id) => {
                const updated = essays.filter(e => e.id !== id);
                setEssays(updated);
                save(updated);
            };

            const filterDate = (essay) => {
                if (filter === 'all' || !essay.timestamp) return true;
                const now = Date.now();
                const day = 24 * 60 * 60 * 1000;
                if (filter === 'today') {
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    return essay.timestamp >= today.getTime();
                }
                if (filter === 'week') return now - essay.timestamp < 7 * day;
                if (filter === 'month') return now - essay.timestamp < 30 * day;
                return true;
            };

            const filtered = essays.filter(filterDate).filter(essay =>
                essay.title.toLowerCase().includes(search.toLowerCase()) ||
                essay.words.some(w => 
                    w.word.toLowerCase().includes(search.toLowerCase()) ||
                    w.meaning.toLowerCase().includes(search.toLowerCase())
                )
            );

            const grouped = filtered.reduce((acc, essay) => {
                if (!acc[essay.date]) acc[essay.date] = [];
                acc[essay.date].push(essay);
                return acc;
            }, {});

            const dates = Object.keys(grouped).sort((a, b) => 
                grouped[b][0].timestamp - grouped[a][0].timestamp
            );

            const saveEdit = (essayId, idx) => {
                const updated = essays.map(essay => {
                    if (essay.id === essayId) {
                        const words = [...essay.words];
                        words[idx] = { ...words[idx], meaning: editText };
                        return { ...essay, words };
                    }
                    return essay;
                });
                setEssays(updated);
                save(updated);
                setEditing(null);
            };

            const bg = darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-indigo-100';
            const cardBg = darkMode ? 'bg-gray-800' : 'bg-white';
            const textPrimary = darkMode ? 'text-gray-100' : 'text-gray-800';
            const textSecondary = darkMode ? 'text-gray-400' : 'text-gray-500';
            const borderColor = darkMode ? 'border-gray-700' : 'border-gray-200';
            const inputBg = darkMode ? 'bg-gray-700 text-white border-gray-600' : 'bg-white border-gray-300';
            const hoverBg = darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-50';
            const accentBg = darkMode ? 'bg-indigo-900' : 'bg-indigo-50';
            const accentText = darkMode ? 'text-indigo-300' : 'text-indigo-900';

            return e('div', { className: `min-h-screen ${bg} p-4` },
                e('div', { className: 'max-w-4xl mx-auto' },
                    // Header
                    e('div', { className: `${cardBg} rounded-lg shadow-lg p-6 mb-6` },
                        e('div', { className: 'flex items-center justify-between mb-6' },
                            e('div', { className: 'flex items-center gap-3' },
                                e('div', { className: 'text-indigo-600' }, 'üìö'),
                                e('h1', { className: `text-2xl font-bold ${textPrimary}` }, 'CAT VARC AEON Prep Tracker')
                            ),
                            e('div', { className: 'flex items-center gap-3' },
                                e('button', {
                                    onClick: () => setDarkMode(!darkMode),
                                    className: `p-2 rounded-lg ${darkMode ? 'bg-gray-700 text-yellow-400' : 'bg-gray-200 text-gray-700'} hover:opacity-80`,
                                    title: darkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'
                                }, darkMode ? '‚òÄÔ∏è' : 'üåô'),
                                e('button', {
                                    onClick: () => setShowForm(!showForm),
                                    className: 'bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700'
                                }, '+ Add Essay')
                            )
                        ),
                        e('div', { className: 'flex gap-2 mb-3' },
                            ['all', 'today', 'week', 'month'].map(f =>
                                e('button', {
                                    key: f,
                                    onClick: () => setFilter(f),
                                    className: `px-3 py-1 rounded-lg text-sm ${filter === f ? 'bg-indigo-600 text-white' : darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-700'}`
                                }, f === 'all' ? 'All Time' : f === 'today' ? 'Today' : f === 'week' ? 'This Week' : 'This Month')
                            )
                        ),
                        e('input', {
                            type: 'text',
                            placeholder: 'Search...',
                            value: search,
                            onChange: (ev) => setSearch(ev.target.value),
                            className: `w-full px-3 py-2 border rounded-lg ${inputBg}`
                        })
                    ),

                    // Form
                    showForm && e('div', { className: `${cardBg} rounded-lg shadow-lg p-6 mb-6` },
                        e('div', { className: 'flex gap-2 mb-6' },
                            ['title', 'words', 'meanings'].map(s =>
                                e('div', { key: s, className: `flex-1 h-2 rounded ${step === s ? 'bg-indigo-600' : darkMode ? 'bg-gray-700' : 'bg-indigo-200'}` })
                            )
                        ),
                        step === 'title' && e('div', null,
                            e('h2', { className: `text-xl font-bold mb-4 ${textPrimary}` }, 'Step 1: Essay Details'),
                            e('input', {
                                type: 'text',
                                placeholder: 'Essay Title',
                                value: form.title,
                                onChange: (ev) => setForm({ ...form, title: ev.target.value }),
                                className: `w-full px-3 py-2 border rounded-lg mb-3 ${inputBg}`
                            }),
                            e('input', {
                                type: 'url',
                                placeholder: 'Essay Link',
                                value: form.link,
                                onChange: (ev) => setForm({ ...form, link: ev.target.value }),
                                className: `w-full px-3 py-2 border rounded-lg mb-3 ${inputBg}`
                            }),
                            e('div', { className: 'flex gap-2' },
                                e('button', {
                                    onClick: next,
                                    className: 'flex-1 bg-indigo-600 text-white py-2 rounded-lg'
                                }, 'Next'),
                                e('button', {
                                    onClick: () => { setShowForm(false); setForm({ title: '', link: '', words: [''] }); setStep('title'); },
                                    className: `flex-1 py-2 rounded-lg ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200'}`
                                }, 'Cancel')
                            )
                        ),
                        step === 'words' && e('div', null,
                            e('h2', { className: `text-xl font-bold mb-4 ${textPrimary}` }, 'Step 2: Add Words'),
                            form.words.map((w, i) =>
                                e('div', { key: i, className: 'flex gap-2 mb-2' },
                                    e('input', {
                                        type: 'text',
                                        value: w,
                                        onChange: (ev) => {
                                            const words = [...form.words];
                                            words[i] = ev.target.value;
                                            setForm({ ...form, words });
                                        },
                                        className: `flex-1 px-3 py-2 border rounded-lg ${inputBg}`,
                                        placeholder: 'Word'
                                    }),
                                    form.words.length > 1 && e('button', {
                                        onClick: () => setForm({ ...form, words: form.words.filter((_, j) => j !== i) }),
                                        className: 'text-red-600'
                                    }, 'üóëÔ∏è')
                                )
                            ),
                            e('button', {
                                onClick: () => setForm({ ...form, words: [...form.words, ''] }),
                                className: 'text-indigo-600 text-sm mb-3'
                            }, '+ Add Word'),
                            e('div', { className: 'flex gap-2' },
                                e('button', {
                                    onClick: () => setStep('title'),
                                    className: `flex-1 py-2 rounded-lg ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200'}`
                                }, 'Back'),
                                e('button', {
                                    onClick: next,
                                    className: 'flex-1 bg-indigo-600 text-white py-2 rounded-lg'
                                }, 'Next')
                            )
                        ),
                        step === 'meanings' && e('div', null,
                            e('h2', { className: `text-xl font-bold mb-4 ${textPrimary}` }, 'Step 3: Write Meanings'),
                            form.words.filter(w => w.trim()).map((w, i) =>
                                e('div', { key: i, className: `border rounded-lg p-3 mb-3 ${borderColor}` },
                                    e('div', { className: `font-bold mb-2 ${textPrimary}` }, w),
                                    e('textarea', {
                                        value: meanings[w] || '',
                                        onChange: (ev) => setMeanings({ ...meanings, [w]: ev.target.value }),
                                        className: `w-full px-3 py-2 border rounded-lg ${inputBg}`,
                                        placeholder: 'Meaning...',
                                        rows: 2
                                    })
                                )
                            ),
                            e('div', { className: 'flex gap-2' },
                                e('button', {
                                    onClick: () => setStep('words'),
                                    className: `flex-1 py-2 rounded-lg ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200'}`
                                }, 'Back'),
                                e('button', {
                                    onClick: submit,
                                    className: 'flex-1 bg-green-600 text-white py-2 rounded-lg'
                                }, 'Save')
                            )
                        )
                    ),

                    // Essays
                    e('div', { className: 'space-y-4' },
                        filtered.length === 0 ? e('div', { className: `${cardBg} rounded-lg shadow p-8 text-center ${textSecondary}` },
                            essays.length === 0 ? 'No essays yet. Click "Add Essay"!' : 'No essays found.'
                        ) : dates.map(date =>
                            e('div', { key: date, className: `${cardBg} rounded-lg shadow-lg p-4` },
                                e('div', { className: `flex items-center gap-2 mb-3 font-bold ${textPrimary}` },
                                    'üìÖ ', date, e('span', { className: `text-sm ${textSecondary} font-normal` },
                                        ` (${grouped[date].length} essay${grouped[date].length > 1 ? 's' : ''})`
                                    )
                                ),
                                grouped[date].map(essay =>
                                    e('div', { key: essay.id, className: `border rounded-lg mb-2 ${borderColor}` },
                                        e('div', {
                                            className: `flex justify-between items-center p-4 cursor-pointer ${hoverBg}`,
                                            onClick: () => setExpanded({ ...expanded, [essay.id]: !expanded[essay.id] })
                                        },
                                            e('div', { className: 'flex items-center gap-2 flex-1' },
                                                e('span', null, expanded[essay.id] ? '‚ñº' : '‚ñ∂'),
                                                e('div', null,
                                                    e('div', { className: `font-bold ${textPrimary}` }, essay.title),
                                                    e('div', { className: `text-sm ${textSecondary}` }, `${essay.words.length} words`)
                                                )
                                            ),
                                            e('div', { className: 'flex gap-2' },
                                                e('a', {
                                                    href: essay.link,
                                                    target: '_blank',
                                                    onClick: (ev) => ev.stopPropagation(),
                                                    className: 'text-indigo-600'
                                                }, 'üîó'),
                                                e('button', {
                                                    onClick: (ev) => { ev.stopPropagation(); del(essay.id); },
                                                    className: 'text-red-600'
                                                }, 'üóëÔ∏è')
                                            )
                                        ),
                                        expanded[essay.id] && e('div', { className: `border-t p-4 ${darkMode ? 'bg-gray-900' : 'bg-gray-50'} ${borderColor} space-y-2` },
                                            essay.words.map((word, idx) => {
                                                const key = `${essay.id}-${idx}`;
                                                const isEdit = editing === key;
                                                const isShow = revealed[key];
                                                return e('div', { key: idx, className: `${accentBg} p-3 rounded-lg border ${borderColor}` },
                                                    e('div', { className: 'flex justify-between' },
                                                        e('div', { className: 'flex-1' },
                                                            e('div', { className: `font-bold ${accentText}` }, word.word),
                                                            isEdit ? e('div', { className: 'flex gap-2 mt-1' },
                                                                e('textarea', {
                                                                    value: editText,
                                                                    onChange: (ev) => setEditText(ev.target.value),
                                                                    className: `flex-1 p-2 border rounded text-sm ${inputBg}`,
                                                                    rows: 2
                                                                }),
                                                                e('button', {
                                                                    onClick: () => saveEdit(essay.id, idx),
                                                                    className: 'text-green-600'
                                                                }, '‚úì'),
                                                                e('button', {
                                                                    onClick: () => setEditing(null),
                                                                    className: 'text-red-600'
                                                                }, '‚úï')
                                                            ) : e('div', { className: `text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'} mt-1` },
                                                                isShow ? (word.meaning || '(No meaning)') : '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'
                                                            )
                                                        ),
                                                        !isEdit && e('div', { className: 'flex gap-2 ml-2' },
                                                            e('button', {
                                                                onClick: () => setRevealed({ ...revealed, [key]: !isShow }),
                                                                className: 'text-indigo-600'
                                                            }, isShow ? 'üôà' : 'üëÅÔ∏è'),
                                                            e('button', {
                                                                onClick: () => { setEditing(key); setEditText(word.meaning); },
                                                                className: darkMode ? 'text-gray-400' : 'text-gray-600'
                                                            }, '‚úèÔ∏è')
                                                        )
                                                    )
                                                );
                                            })
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(CATTracker));
    </script>
</body>
</html>
